<%- include('../includes/head.ejs') %>
<%- include('../includes/header.ejs') %>
<%- include('../includes/navbar.ejs') , { isLoggedIn: isLoggedIn }%>
<body>

<!-- Body content -->
<div class="page-head"> 
    <div class="container">
        <div class="row">
            <div class="page-head-content">
                <h1 class="page-title">List Layout With Sidebar</h1>               
            </div>
        </div>
    </div>
</div>

<!-- property area -->
<div class="properties-area recent-property" style="background-color: #FFF;">
   
    <div class="container">
        <!-- <% if (!isLoggedIn) { %>
  <div class="alert alert-warning text-center mt-3">
    Only 8 properties visible. <a href="/login">Login</a> to view more.
  </div>
<% } %> -->
        <div class="row  pr0 padding-top-40 properties-page">
          
        <%- include('../includes/filterProperty.ejs') %>
            <div class="col-md-12 padding-bottom-40 large-search">
                <div class="col-md-12  clear"> 
                    <div class="col-xs-10 page-subheader sorting pl0">
                        <ul class="sort-by-list">
                            <li class="active">
                                <a href="javascript:void(0);" class="order_by_date" data-orderby="property_date" data-order="ASC">
                                    Property Date <i class="fa fa-sort-amount-asc"></i>					
                                </a>
                            </li>
                            <li class="">
                                <a href="javascript:void(0);" class="order_by_price" data-orderby="property_price" data-order="DESC">
                                    Property Price <i class="fa fa-sort-numeric-desc"></i>						
                                </a>
                            </li>
                        </ul><!--/ .sort-by-list-->

                        
                    </div>

                    <div class="col-xs-2 layout-switcher">
                        <a class="layout-list" href="javascript:void(0);"> <i class="fa fa-th-list"></i>  </a>
                        <a class="layout-grid active" href="javascript:void(0);"> <i class="fa fa-th"></i> </a>                          
                    </div><!--/ .layout-switcher-->
                </div>

                <div class="col-md-12 clear ">
                    <div id="list-type" class="proerty-th">
                        <% properties.forEach(property => { %>
                        <div class="col-sm-6 col-md-3 p0">
                            <div class="box-two proerty-item">
                                
                                <div class="item-thumb">
                                    <a href="/property/<%= property._id %>">
                                        <img
                                          src="/uploads/<%= property.image %>"
                                          alt="Property Image"
                                          
                                        >
                                      </a>
                                   
                                </div>

                                <div class="item-entry overflow">
                                    <h5><a href="/property/<%= property._id %>"><%= property.name.slice(0, 18) %></a></h5>
                                    <div class="dot-hr"></div>
                                    <span class="pull-left"><b> Area :</b><%= property.area %>m² </span>
                                    <span class="proerty-price pull-right">$ <%= property.price.toLocaleString() %></span>
                                    
                                    <% if (property.saleStatus === 'sold') { %>
                                        <div class="text-center" style="clear: both; padding-top: 10px;">
                                            <button class="btn" style="background-color: #808080; color: white; font-weight: bold; padding: 6px 12px; border-radius: 4px; text-transform: uppercase; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 100%; cursor: not-allowed;" disabled>
                                                SOLD OUT
                                            </button>
                                        </div>
                                    <% } else if (isLoggedIn && !isAgent) { %>
                                        <div class="text-center" style="clear: both; padding-top: 10px;">
                                            <a href="/property/buy/<%= property._id %>" class="btn" style="background-color: #d3a033; color: white; font-weight: bold; padding: 6px 12px; border-radius: 4px; text-transform: uppercase; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 100%; display: block;">
                                                Buy Now
                                            </a>
                                        </div>
                                    <% } %>
                                    
                                    <p style="display: none;"><%= property.description %>...</p>
                                    <div class="property-icon">
                                        <img src="/assets/img/icon/bed.png">(<%= property.beds %>) |
                                        <img src="/assets/img/icon/shawer.png">(<%= property.baths %>) 
                                    </div>
                                </div>


                            </div>
                        </div>
                        <% }) %>
                    </div>
                </div>

                <div class="col-md-12 clear"> 
                    <% if (!disablePagination) { %>
                    <div class="pull-right">
                        <div class="pagination">
                            <ul>
                             <% if (currentPage > 1) { %>
        <li class="page-item">
          <a class="page-link" href="?page=<%= currentPage - 1 %>">Previous</a>
        </li>
      <% } %>
 
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
          <a class="page-link" href="?page=<%= i %>"><%= i %></a>
        </li>
      <% } %>
 
      <% if (currentPage < totalPages) { %>
        <li class="page-item">
          <a class="page-link" href="?page=<%= currentPage + 1 %>">Next</a>
        </li>
      <% } %>
                            </ul>
                        </div>
                    </div> 
                   <% } %>              
                </div>
            </div>
        </div>
    </div>
    <%- include('../includes/footer.ejs') %>
   <% if (!isLoggedIn) { %>
<script>
  setTimeout(() => {
    if (!document.getElementById('login-popup')) {
      const popup = document.createElement('div');
popup.id = 'login-popup';
      popup.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background-color: rgba(0,0,0,0.5); display: flex;
                    align-items: center; justify-content: center; z-index: 1000;">
          <div class="popup-content" style="
              background: white; padding: 20px 15px; border-radius: 8px;
              text-align: center; max-width: 400px; width: 90%;
              position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
              
            <button onclick="document.getElementById('login-popup').remove()"
                    style="position: absolute; top: -10px; right: -10px;
                    background: #fff; border: 1px solid #ccc; border-radius: 50%;
                    width: 30px; height: 30px; font-weight: bold; cursor: pointer;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);">×</button>
                    
            <h4 style="margin-top: 10px;">Please Login to see more properties</h4>
            <a href="/login" class="btn" style="
                margin-top: 15px; background-image: linear-gradient(to bottom, #fad609, #fad609);
                color: white; font-weight: bold; padding: 10px 20px; border-radius: 4px;
                display: inline-block;">Login</a>
          </div>
        </div>
      `;
      document.body.appendChild(popup);
    }
  }, 25000);
</script>
<% } %>
</body>

